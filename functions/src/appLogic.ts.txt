// appLogic.ts
interface Cliente {
  nome: string;
  numero: string;
  vencimento: string;
  endereco?: string;
}

interface Piscina {
  comprimento: number;
  largura: number;
  fundo: number;
  km?: number; // distância para calcular taxa extra
}

// Base de clientes (exemplo, substitua pelo Firebase real depois)
const clientesDB: Cliente[] = [
  { nome: "João", numero: "5511999999999", vencimento: "2026-01-20" }
];

// Exemplo de tabela de preços
const precoPorMetroCubico = 50;
const taxaExtraPorKm = 10;

export function calcularOrcamento(piscina: Piscina) {
  const volume = piscina.comprimento * piscina.largura * piscina.fundo; // m³
  let valor = volume * precoPorMetroCubico;
  if (piscina.km && piscina.km > 5) {
    valor += (piscina.km - 5) * taxaExtraPorKm;
  }
  return valor;
}

export async function getClientePorNumero(numero: string): Promise<Cliente | undefined> {
  return clientesDB.find(c => c.numero === numero);
}

export async function getClientesComVencimentoProximo(): Promise<Cliente[]> {
  const hoje = new Date();
  return clientesDB.filter(c => {
    const venc = new Date(c.vencimento);
    const diff = (venc.getTime() - hoje.getTime()) / (1000*60*60*24);
    return diff >=0 && diff <=3; // vencimento nos próximos 3 dias
  });
}
